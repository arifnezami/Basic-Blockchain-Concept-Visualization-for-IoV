<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Basic Blockchain Concept Visualization for IoV</title>
         <meta name="description" content="Basic Blockchain Concept Visualization for IoV : Metro Station Visualization" />
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta http-equiv="x-ua-compatible" content="ie=edge" />
            <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" />
         <style>
        
        .line-1
        {
            position: relative;
            top: 50%;  
            width: 24em;
            margin: 0 auto;
            border-right: 2px solid rgba(255,255,255,.75);
            font-size: 180%;
            text-align: left;
            white-space: nowrap;
            overflow: hidden;
            transform: translateY(-50%);    
        }
    
    /* Animation */
    .anim-typewriter{
      animation: 
                 blinkTextCursor 500ms steps(44) infinite normal;
    }
    @keyframes typewriter{
      from{width: 0;}
      to{width: 24em;}
    }
    @keyframes blinkTextCursor{
      from{border-right-color: rgba(144,238,144 ,1 );}
      to{border-right-color: transparent;}
    }
            
    </style>

    <style>
    .footer {
      position: relative;
      left: 0;
      bottom: 0;
      width: 100%;
      background-color: white;
      color: grey;
      text-align: center;
    }
</style>

    </head>
    <body>
        <!--<div class="col-md-12">-->
        <!--<img src="https://source.unsplash.com/random/1920x1080" height="250px" class="card-img-top" alt="..." style="margin-top: 20px; margin-bottom: 20px;">-->
    	<!--</div>-->
        <div class="container">
    		
    		<div id="main" class="row mb-5" style="margin-top: 40px;">
    			<div class="col-md-6">
    				<div id="card1" class="card">
    					<img src="images/unsplash-metro.jpeg" class="card-img-top" alt="...">
    					<div class="card-body">
    					    <p>Welcome to Virtual Metro Station. Select the entry station you want to board from. Also, add a random number as your user id. In real life scenario, that will be auto fetched from your NFC based ID or mobile phone.</p>
    						<label for="from">Check in Station</label>
                            <select class="form-control" name="from" id="from" required>
                             <option value="">--Select One--</option>
                              <option value="1">Station 1: Farmgate</option>
                              <option value="2">Station 2: Mirpur</option>
                              <option value="3">Station 3: Banani</option>
                              <option value="4">Station 4: Gulshan</option>
                              <option value="5">Station 5: Motijheel</option>
                              <option value="6">Station 6: Jatrabari</option>
                              <option value="7">Station 7: Mohakhali</option>
                              <option value="8">Station 8: Rampura</option>
                            </select>
                            <br>
                            <label for="cars">User ID</label>
                           <input id="id" type="number" class="form-control" placeholder="Add a random number as ID"  required />
                            <br>
                            <button id="go" class="btn btn-md btn-success">Check In</button>
    					</div>
    				</div>
    				
    				<div id="card2" class="card" style="display: none;">
    					<img src="https://source.unsplash.com/1600x900/?metro" class="card-img-top" alt="...">
    					<div class="card-body">
    					    <p>Now select a station where the user will get down. You will be able to see the checkout station data and fare in the sample Blockchain Console.</p>
    						<label for="from">Check Out Station</label>
                            <select class="form-control" name="from" id="end" required>
                              <option value="">--Select One--</option>
                              <option value="1">Station 1: Farmgate</option>
                              <option value="2">Station 2: Mirpur</option>
                              <option value="3">Station 3: Banani</option>
                              <option value="4">Station 4: Gulshan</option>
                              <option value="5">Station 5: Motijheel</option>
                              <option value="6">Station 6: Jatrabari</option>
                              <option value="7">Station 7: Mohakhali</option>
                              <option value="8">Station 8: Rampura</option>
                            </select>
                            <br>
                            <label for="cars">User ID</label>
                            <input id="id2" type="text" class="form-control" placeholder="Add a random number as ID" required />
                            <br>
                            <button id="checkout" class="btn btn-md btn-success">Checkout</button>
    					</div>
    				</div>
    			</div>
    			<div class="col-md-6">
    				<div id="card22" class="card" style="display: none;">
    					<img src="https://dis-blog.thalesgroup.com/wp-content/uploads/2018/12/blockchain-security-507x380.jpg" class="card-img-top" alt="...">
    					<div class="card-body" style="background-color: black; color: lightgreen; font-size: 10px; font-family: 'Press Start 2P', cursive;">
    						<!--<a href="#" class="btn btn-sm btn-primary">Cost</a>-->
    						
    						<!--<p id="cost-text" class="card-text" style="margin-top: 30px;">Here your cost will appear after checking out.</p>-->
    						  <p id="id-response line-1 anim-typewriter" class="card-text" style="margin-top: 30px;"><span id="id-result"></span></p> <p class="line-1 anim-typewriter">###</p>
    						  <p class="line-1 anim-typewriter"></p>
    					    <!--<p id="cost-response" class="card-text" style="margin-top: 30px; display: none;"><span id="cost-result"></span></p>-->
    					</div>
    				</div>
    			</div>
    		</div>
    		
    		<!-- row -->
    	</div>

   


<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
<script>
    $("#go").click(function(){
      var from = $("#from").val();
      var id = $("#id").val();
      if(from=='' || id==''){
          alert("All fields are mandatory to be filled.");
      }
      else{
          window.start = from;
          window.Id = id;
          
          $("#card1").hide();
          $("#card2").show();
          $("#card22").show();
        //   $("#cost-text").text(id);
           
           
            var data = ' { user :'+id+' }';
            var data2 = '{ on_board_station : '+from+' }';
            
           // $("#cost-text").hide();
           // $("#cost-response").show();
            // $("#cost-result").text(cost);
            $("#id-result").show();
        //    $("#id-result").text(id1);
            $("#id-result").append('<br> '+data+'<br>'+data2);
            var crypto = data+' '+data2;
            crypto = Base64.encode(crypto);
            $("#id-result").append('<br>{ crypto: '+crypto+' }<br>');
            window.crypo = crypto;
           
           
         // $("#card1").hide();
      
      }
    });
    
    $("#checkout").click(function(){
        console.log(window.start);
        
        var start = window.start;
        var id1 = window.Id;
        var end = $("#end").val();
        var id2 = $("#id2").val();
        
        if(end=='' || id2==''){
            alert("All fields are mandatory to be filled.");
        }
        else if(id1!=id2){
            alert("ID mismatch occured. Try again with correct ID.");
        }
        else{
            var x = Math.abs(end - start);
            var cost = x*10;
            var data3 = ' { user :'+id1+' }';
            var data = ' { exit_station :'+end+' }';
            var data2 = '{ cost : '+cost+' bdt }';
            
            $("#cost-text").hide();
           // $("#cost-response").show();
            // $("#cost-result").text(cost);
            $("#id-response").show();
        //    $("#id-result").text(id1);
            $("#id-result").append('<br> '+data3+' <br> '+data+'<br>'+data2);
            
            var crypto2 = 'Previous Hash: '+window.crypo+' '+data+' '+data2;
            crypto2 = Base64.encode(crypto2);
            $("#id-result").append('<br>{ crypto: '+crypto2+' } <br>');
            
            $("#card2").hide();
          $("#card1").show();
          cost = 0;
        }
    });
    
    
    var Base64 = {


    _keyStr: "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",


    encode: function(input) {
        var output = "";
        var chr1, chr2, chr3, enc1, enc2, enc3, enc4;
        var i = 0;

        input = Base64._utf8_encode(input);

        while (i < input.length) {

            chr1 = input.charCodeAt(i++);
            chr2 = input.charCodeAt(i++);
            chr3 = input.charCodeAt(i++);

            enc1 = chr1 >> 2;
            enc2 = ((chr1 & 3) << 4) | (chr2 >> 4);
            enc3 = ((chr2 & 15) << 2) | (chr3 >> 6);
            enc4 = chr3 & 63;

            if (isNaN(chr2)) {
                enc3 = enc4 = 64;
            } else if (isNaN(chr3)) {
                enc4 = 64;
            }

            output = output + this._keyStr.charAt(enc1) + this._keyStr.charAt(enc2) + this._keyStr.charAt(enc3) + this._keyStr.charAt(enc4);

        }

        return output;
    },


    decode: function(input) {
        var output = "";
        var chr1, chr2, chr3;
        var enc1, enc2, enc3, enc4;
        var i = 0;

        input = input.replace(/[^A-Za-z0-9\+\/\=]/g, "");

        while (i < input.length) {

            enc1 = this._keyStr.indexOf(input.charAt(i++));
            enc2 = this._keyStr.indexOf(input.charAt(i++));
            enc3 = this._keyStr.indexOf(input.charAt(i++));
            enc4 = this._keyStr.indexOf(input.charAt(i++));

            chr1 = (enc1 << 2) | (enc2 >> 4);
            chr2 = ((enc2 & 15) << 4) | (enc3 >> 2);
            chr3 = ((enc3 & 3) << 6) | enc4;

            output = output + String.fromCharCode(chr1);

            if (enc3 != 64) {
                output = output + String.fromCharCode(chr2);
            }
            if (enc4 != 64) {
                output = output + String.fromCharCode(chr3);
            }

        }

        output = Base64._utf8_decode(output);

        return output;

    },

    _utf8_encode: function(string) {
        string = string.replace(/\r\n/g, "\n");
        var utftext = "";

        for (var n = 0; n < string.length; n++) {

            var c = string.charCodeAt(n);

            if (c < 128) {
                utftext += String.fromCharCode(c);
            }
            else if ((c > 127) && (c < 2048)) {
                utftext += String.fromCharCode((c >> 6) | 192);
                utftext += String.fromCharCode((c & 63) | 128);
            }
            else {
                utftext += String.fromCharCode((c >> 12) | 224);
                utftext += String.fromCharCode(((c >> 6) & 63) | 128);
                utftext += String.fromCharCode((c & 63) | 128);
            }

        }

        return utftext;
    },

    _utf8_decode: function(utftext) {
        var string = "";
        var i = 0;
        var c = c1 = c2 = 0;

        while (i < utftext.length) {

            c = utftext.charCodeAt(i);

            if (c < 128) {
                string += String.fromCharCode(c);
                i++;
            }
            else if ((c > 191) && (c < 224)) {
                c2 = utftext.charCodeAt(i + 1);
                string += String.fromCharCode(((c & 31) << 6) | (c2 & 63));
                i += 2;
            }
            else {
                c2 = utftext.charCodeAt(i + 1);
                c3 = utftext.charCodeAt(i + 2);
                string += String.fromCharCode(((c & 15) << 12) | ((c2 & 63) << 6) | (c3 & 63));
                i += 3;
            }

        }

        return string;
    }

}
    
</script>
<div class="footer">
  <p>Created by Arif Nezami | Images: Unsplash.com</p>
</div>
</body>

</html>
